<div class="p-4 px-8">
  <div class="max-w-screen-xl mx-auto">
    <!-- Encabezado -->
    <div class="border-b border-gray-300 pb-4 flex items-center flex-wrap gap-4">
      

      <div class="ml-auto flex gap-2 p-4">
        <div class="flex items-center px-4 py-2 rounded-md  border border-gray-300 overflow-hidden max-w-xs w-full">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192.904 192.904"
               class="fill-gray-600 mr-2 w-4 h-4">
            <path
              d="m190.707 180.101-47.078-47.077c11.702-14.072 18.752-32.142 18.752-51.831C162.381 36.423 125.959 0 81.191 0 36.422 0 0 36.423 0 81.193c0 44.767 36.422 81.187 81.191 81.187 19.688 0 37.759-7.049 51.831-18.751l47.079 47.078a7.474 7.474 0 0 0 5.303 2.197 7.498 7.498 0 0 0 5.303-12.803zM15 81.193C15 44.694 44.693 15 81.191 15c36.497 0 66.189 29.694 66.189 66.193 0 36.496-29.692 66.187-66.189 66.187C44.693 147.38 15 117.689 15 81.193z">
            </path>
          </svg>
          <input
            type="text"
            placeholder="Buscar producto..."
            class="w-full outline-none bg-transparent text-slate-600 text-sm"
          />
        </div>

        <button
          type="button"
          (click)="openModal()"
          class="text-white font-bold flex items-center px-4 rounded-md bg-orange-500 hover:bg-orange-600 shadow-sm cursor-pointer"
        >
          <img src="assets/anadir-seleccion.png" alt="logo" class="w-7 h-7" />
          Añadir Producto
        </button>
      </div>
    </div>

    <!-- Lista de productos -->
    <div class="divide-y divide-gray-300">
      <!-- Producto -->
      <div
        *ngFor="let textil of listaProductos"
        class="grid grid-cols-5 max-md:grid-cols-2 items-start justify-between gap-2 py-2"
      >
        <!-- Imagen y nombre -->
        <div class="md:col-span-2 flex items-start gap-4 max-sm:flex-col">
          <div class="bg-gray-100 p-2 rounded-lg w-20 h-20 shrink-0 flex items-center justify-center">
            <img
              *ngIf="textil.imagen; else noImg"
              [src]="textil.imagen"
              alt="Imagen de {{ textil.nombre }}"
              class="w-full h-full object-contain rounded"
            />
            <ng-template #noImg>
              <span class="text-xs text-gray-500">Sin imagen</span>
            </ng-template>
          </div>
          <div>
            <h6 class="text-[15px] font-semibold text-slate-900">{{ textil.nombre }}</h6>
            <p class="text-[14px] text-slate-500 font-medium mt-1">{{ textil.descripcion }}</p>
          </div>
        </div>

        <!-- Tallas -->
        <div>
          <h6 class="text-[14px] font-medium text-slate-500">Tallas</h6>
          <p class="text-[14px] text-slate-900 font-medium mt-2">{{ textil.tallas }}</p>
        </div>

        <!-- Cantidad total -->
        <div>
          <h6 class="text-[14px] font-medium text-slate-500">Cantidad</h6>
          <p class="text-[14px] text-slate-900 font-medium mt-2">{{ textil.cantidadTotal }}</p>
        </div>

        <!-- Acciones -->
        <div class="">
          <h6 class="text-[14px] font-medium text-slate-500">Acciones</h6>
          <div class="flex  mt-2">
            <button
              class="text-blue-500 hover:text-blue-700 flex items-center gap-1 text-sm"
              (click)="editarPrenda(textil)"
            >
              <svg  class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21.2799 6.40005L11.7399 15.94C10.7899 16.89 7.96987 17.33 7.33987 16.7C6.70987 16.07 7.13987 13.25 8.08987 12.3L17.6399 2.75002C17.8754 2.49308 18.1605 2.28654 18.4781 2.14284C18.7956 1.99914 19.139 1.92124 19.4875 1.9139C19.8359 1.90657 20.1823 1.96991 20.5056 2.10012C20.8289 2.23033 21.1225 2.42473 21.3686 2.67153C21.6147 2.91833 21.8083 3.21243 21.9376 3.53609C22.0669 3.85976 22.1294 4.20626 22.1211 4.55471C22.1128 4.90316 22.0339 5.24635 21.8894 5.5635C21.7448 5.88065 21.5375 6.16524 21.2799 6.40005V6.40005Z" stroke="#008000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M11 4H6C4.93913 4 3.92178 4.42142 3.17163 5.17157C2.42149 5.92172 2 6.93913 2 8V18C2 19.0609 2.42149 20.0783 3.17163 20.8284C3.92178 21.5786 4.93913 22 6 22H17C19.21 22 20 20.2 20 18V13" stroke="#008000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>

            <button
              class="text-red-500 hover:text-red-700 flex items-center gap-1 text-sm"
              (click)="eliminarPrenda(textil.id)"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M5 6h14M9 6V4h6v2m2 0v14H7V6m5 4v6m-4-6v6m8-6v6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Sin registros -->
      <div *ngIf="!listaProductos || listaProductos.length < 1" class="py-8 text-center text-gray-500">
        No hay productos registrados en el inventario.
      </div>
    </div>
  </div>
</div>

<div *ngIf="showModal" class="fixed inset-0 flex items-center justify-center">
  <div class="bg-white rounded-lg p-6 w-96 border border-gray-300">
    <h2 class="text-lg font-normal mb-4">
      {{ modoEdicion ? 'Editar Producto' : 'Registrar Producto' }}
    </h2>

    <!-- Nombre -->
    <input type="text" placeholder="Nombre del producto" [value]="nombreProducto"
      (input)="nombreProducto = $any($event.target).value" class="border p-2 mb-2 w-full rounded border-gray-500" />
    <!-- Descripción -->
    <textarea placeholder="Descripción" [value]="descripcionProducto"
      (input)="descripcionProducto = $any($event.target).value"
      class="border p-2 mb-2 w-full rounded border-gray-500"></textarea>

    <!-- Selección de tallas -->
    <h3 class="font-semibold mb-2">Seleccionar Tallas:</h3>
    <div class="flex gap-2 mb-4 items-center">
      <!-- Dropdown -->
      <select [(ngModel)]="tallaSeleccionada"
        class="border border-gray-500 p-2 rounded w-full focus:ring-2 focus:ring-blue-400 focus:outline-none">
        <option value="" disabled selected>-- Selecciona una talla --</option>
        <option *ngFor="let talla of listaTallas" [ngValue]="talla">
          {{ talla.talla }} — {{ talla.tipo }} — {{ talla.sexo }}
        </option>
      </select>

      <!-- Botón Agregar -->
      <button (click)="agregarTalla($any(tallaSeleccionada) ? {
          id_talla: $any(tallaSeleccionada).id,
          nombre: $any(tallaSeleccionada).talla,
          cantidad: 1, precio: 0,
          sexo: $any(tallaSeleccionada).sexo,
          tipo: $any(tallaSeleccionada).tipo,
          } : null)" class="bg-green-500 text-white px-3 py-2 rounded hover:bg-green-600 transition"
        [disabled]="!tallaSeleccionada">
        Agregar
      </button>
    </div>

    <!-- Encabezado -->
    <h3 class="font-semibold mb-2">Tallas seleccionadas:</h3>

    <!-- Si hay tallas -->
    <div *ngIf="tallasSeleccionadas.length > 0; else noTallasSel"
      class="overflow-x-auto border border-gray-500 rounded-lg p-2">

      <!-- Contenedor scrollable -->
      <div class="min-w-[600px]">
        <!-- Encabezado -->
        <div
          class="grid grid-cols-6 gap-2 mb-2 font-semibold border-b border-gray-500 pb-1 text-gray-700 text-sm text-center">
          <span>Talla</span>
          <span>Cantidad</span>
          <span>Precio</span>
          <span>Tipo</span>
          <span>Sexo</span>
          <span></span> <!-- Botón X -->
        </div>

        <!-- Filas -->
        <div *ngFor="let t of tallasSeleccionadas" class="grid grid-cols-6 gap-2 mb-1 text-center items-center text-sm">
          <span>{{ t.nombre }}</span>

          <input type="number" placeholder="Cantidad" [value]="t.cantidad"
            (input)="t.cantidad = $any($event.target).value"
            class="border border-gray-500 p-1 rounded text-center w-full" />

          <input type="number" placeholder="Precio" [value]="t.precio" (input)="t.precio = $any($event.target).value"
            class="border border-gray-500 p-1 rounded text-center w-full" />

          <span>{{ getTipoSexoPorTalla(t.id_talla!).tipo || '-' }}</span>
          <span>{{ getTipoSexoPorTalla(t.id_talla!).sexo || '-' }}</span>

          <button (click)="eliminarTallaSeleccionada(t.id_talla!)"
            class="bg-red-500 text-white px-2 py-1 rounded w-fit mx-auto hover:bg-red-600 transition">
            X
          </button>
        </div>
      </div>
    </div>


    <!-- Si no hay tallas seleccionadas -->
    <ng-template #noTallasSel>
      <p class="text-gray-500 text-center">No ha seleccionado ninguna talla aún.</p>
    </ng-template>
    <h3 class="font-semibold mb-2">Subir imágenes (máx. 5)</h3>
    <input type="file" multiple accept="image/*" (change)="handleFileInput($event)"
      class="border border-gray-500 p-2 rounded w-full mb-2" />
    <div class="flex gap-2">
      <div *ngFor="let img of imagenesSeleccionadas; let i = index"
        class="w-16 h-16 border border-gray-500 rounded overflow-hidden">
        <img [src]="img" alt="Imagen {{i+1}}" class="w-full h-full object-cover" />
      </div>
    </div>

    <!-- Botones -->
    <div class="flex justify-end gap-2 mt-4">
      <button (click)="closeModal()" class="px-4 py-2 bg-gray-300 rounded">Cancelar</button>
      <button (click)="guardarProducto()" class="px-4 py-2 bg-blue-500 text-white rounded">
        {{ modoEdicion ? 'Actualizar' : 'Guardar' }}
      </button>

    </div>
  </div>
</div>